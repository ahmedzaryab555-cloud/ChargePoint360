<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ChargePoint360 — Dubai EV Map (Dark UI, Light Map)</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

<!-- Marker Cluster CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

<style>
  :root{
    --bg:#0f1720;         /* dark background */
    --panel:#0b1220;      /* panel */
    --accent:#00d07a;     /* green accent */
    --muted:#9aa5b1;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6eef6;background:var(--bg)}
  header{height:62px;display:flex;align-items:center;gap:12px;padding:10px 14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 2px 8px rgba(0,0,0,0.4)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#0bb36b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#062018}
  .title{font-size:16px;font-weight:600}
  .subtitle{font-size:12px;color:var(--muted)}
  main{display:flex;flex:1;min-height:0} /* allow children to shrink on mobile */
  #map{flex:1;min-height:0;height:calc(100vh - 62px);} /* full height minus header */
  /* sidebar */
  .sidebar{width:360px;max-width:44%;background:linear-gradient(180deg,var(--panel), rgba(255,255,255,0.02));padding:16px;border-left:1px solid rgba(255,255,255,0.02);box-shadow:inset 0 1px 0 rgba(255,255,255,0.02);overflow:auto}
  .controls{display:flex;flex-direction:column;gap:10px}
  .filters{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:999px;color:var(--muted);font-weight:600;cursor:pointer}
  .chip.active{color:var(--accent);border-color:rgba(0,208,122,0.15);box-shadow:0 6px 20px rgba(0,208,122,0.06), inset 0 -2px 0 rgba(255,255,255,0.02)}
  .search{display:flex;gap:8px}
  .search input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#e6eef6}
  .btn{padding:10px 12px;border-radius:10px;background:linear-gradient(180deg,var(--accent),#00b86a);color:#062018;border:none;font-weight:700;cursor:pointer}
  .list{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  .station{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02);cursor:pointer}
  .station h4{margin:0 0 6px 0;font-size:14px}
  .station p{margin:0;color:var(--muted);font-size:13px}
  .meta{font-size:12px;color:var(--muted);margin-top:6px}
  footer{padding:12px;text-align:center;color:var(--muted);font-size:13px;border-top:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
  /* small helper controls in map */
  .map-topright{position:absolute;top:80px;right:12px;z-index:1000;display:flex;flex-direction:column;gap:8px}
  .mini-btn{background:var(--glass);border:1px solid rgba(255,255,255,0.02);padding:8px;border-radius:10px;color:#eaf6ee;cursor:pointer}
  /* license block style */
  .license{margin-top:12px;background:transparent;color:var(--muted);font-size:13px}
  .small-link{color:var(--muted);text-decoration:none}

  /* =========================
     Mobile improvements
     ========================= */
  @media (max-width:980px){
    .sidebar{
      position: fixed;
      z-index: 1000;
      left: -100%; /* hide by default */
      top: 62px;
      width: 85%;
      max-width: 360px;
      border-radius: 12px;
      padding: 12px;
      backdrop-filter: blur(8px);
      transition: left 0.3s ease;
      height: calc(100vh - 62px);
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .sidebar.show { left: 10px; } /* show sidebar */

    /* Toggle button */
    #btnToggleSidebar {
      position: fixed;
      top: 14px;
      left: 14px;
      z-index: 1100;
      padding: 10px 12px;
      border-radius: 10px;
      background: var(--accent);
      color: #062018;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    #map { height: 100vh; }

    /* Touch-friendly inputs */
    .search input { padding: 14px; font-size: 16px; }
    .chip, .btn, .mini-btn { padding: 12px 14px; font-size: 14px; }
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">CP</div>
    <div>
      <div class="title">ChargePoint360</div>
      <div class="subtitle">Dubai EV Charging — interactive demo</div>
    </div>
  </div>
</header>

<main>
  <!-- Map container -->
  <div id="map" role="application" aria-label="Interactive map of EV chargers in Dubai"></div>

  <!-- Sidebar (collapsible on mobile) -->
  <aside class="sidebar" id="sidebar" aria-labelledby="controlsTitle">
    <div class="controls">
      <div id="controlsTitle" style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong style="font-size:16px">Stations</strong><br/>
          <span style="font-size:13px;color:var(--muted)">Tap a marker — use filters (1,2,3)</span>
        </div>
        <button class="btn" id="btnLocate" title="Find my location">Locate</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:8px">
        <div class="filters" role="group" aria-label="Filter by type">
          <div class="chip active" data-type="public">1 — Public</div>
          <div class="chip active" data-type="fast">2 — Fast</div>
          <div class="chip active" data-type="wallbox">3 — Wall-Box</div>
        </div>
      </div>

      <div class="search" style="margin-top:8px">
        <input id="q" type="search" placeholder="Search station or area..." aria-label="Search stations">
        <button id="btnSearch" class="chip">Search</button>
      </div>

      <div class="list" id="stationList" aria-live="polite" style="margin-top:8px;max-height:54vh;overflow:auto"></div>
    </div>
  </aside>
</main>

<footer>
  <div class="content_section_text">
    <p>
      <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by/4.0/88x31.png"/>
      </a>
      <br>
      <a href="http://74.225.206.44/">Chargepoint360</a> © 2025 by <a href="http://74.225.206.44/">Ahmed Zaryab Haider</a> is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
      <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;">
      <img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;">
    </p>
  </div>
</footer>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<!-- Marker cluster plugin -->
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
/* =========================
   Map setup (light basemap)
   ========================= */
const map = L.map('map', {zoomControl:true, minZoom: 10}).setView([25.2048,55.2708], 11);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap & CartoDB',
  maxZoom: 19
}).addTo(map);

/* =========================
   Helper: SVG marker generator
   ========================= */
function makeSVGIcon(color, letter){
  const svg = encodeURIComponent(`
    <svg xmlns='http://www.w3.org/2000/svg' width='48' height='64' viewBox='0 0 48 64'>
      <defs>
        <filter id="f1" x="-50%" y="-50%" width="200%" height="200%">
          <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#000" flood-opacity="0.25"/>
        </filter>
      </defs>
      <path d="M24 2C14 2 6 10 6 20c0 13.5 14 33.5 16.5 36.8.6.7 1.6.7 2.2 0C28 53.5 42 33.5 42 20 42 10 34 2 24 2z" fill="${color}" filter="url(#f1)"/>
      <circle cx="24" cy="20" r="8" fill="#fff"/>
      <text x="24" y="24" font-size="10" text-anchor="middle" fill="${color}" font-weight="800">${letter}</text>
    </svg>`);
  return L.divIcon({
    html: `<img src="data:image/svg+xml;charset=utf-8,${svg}" style="width:36px;height:48px;display:block"/>`,
    className: '',
    iconSize: [36,48],
    iconAnchor: [18,48],
    popupAnchor: [0,-42]
  });
}

/* Icons: 1=public (green), 2=fast (red), 3=wallbox (blue) */
const icons = {
  public: makeSVGIcon('#00d07a','1'),
  fast:   makeSVGIcon('#ff5f5f','2'),
  wallbox:makeSVGIcon('#5fb3ff','3')
};

/* =========================
   Sample stations dataset
   ========================= */
const stations = [
  {name:"DEWA Head Office — Customer Happiness", coords:[25.154015,55.232504], type:"public", info:"DEWA Green Charger — Customer service area", source:"https://www.dewa.gov.ae"},
  {name:"DEWA Umm Ramool Customer Centre", coords:[25.232263,55.369513], type:"public", info:"DEWA Green Charger at Umm Ramool", source:"https://www.dewa.gov.ae"},
  {name:"Mall of the Emirates — Level 2 Parking", coords:[25.116742,55.202845], type:"fast", info:"Mall charger (fast/Tesla plug options)", source:"https://www.plugshare.com"},
  {name:"Dubai Marina Mall — Parking Garage", coords:[25.07637,55.14214], type:"public", info:"Marina Mall public charger cluster", source:"https://www.plugshare.com"},
  {name:"The Dubai Mall — DIFC / Downtown area", coords:[25.1995,55.2774], type:"public", info:"Downtown/Tourist area chargers", source:"https://www.dewa.gov.ae"},
  {name:"City Walk — Jumeirah", coords:[25.1973,55.2423], type:"wallbox", info:"Retail district wall-box chargers", source:"https://www.plugshare.com"},
  {name:"Jumeirah Beach Residence — JBR", coords:[25.0782,55.1315], type:"public", info:"JBR & Marina promenade", source:"https://www.plugshare.com"},
  {name:"Dubai International Airport — DXB (parking)", coords:[25.2532,55.3657], type:"fast", info:"Airport area fast chargers", source:"https://www.electromaps.com"},
  {name:"City Centre Deira — Parking", coords:[25.2631,55.3249], type:"public", info:"Deira shopping mall chargers", source:"https://www.plugshare.com"},
  {name:"City Centre Mirdif — Parking", coords:[25.2320,55.3935], type:"public", info:"Mirdif mall chargers", source:"https://haladrive.ae"},
  {name:"Dubai Festival City — Mall parking", coords:[25.2533,55.3339], type:"public", info:"Festival City mall chargers", source:"https://www.plugshare.com"},
  {name:"Rove Downtown — Opera / Hotel area", coords:[25.1976,55.2791], type:"wallbox", info:"Hotel & short-stay chargers", source:"https://www.plugshare.com"},
  {name:"Al Ghurair Centre — Deira", coords:[25.2648,55.3125], type:"public", info:"Shopping centre chargers", source:"https://www.plugshare.com"},
  {name:"Dubai Parks & Resorts — Main entrance", coords:[25.0110,55.0020], type:"public", info:"Theme park EV chargers", source:"https://www.plugshare.com"},
  {name:"Jebel Ali — JAFZA / Dubai South", coords:[24.9843,55.0292], type:"public", info:"Industrial & logistic area chargers", source:"https://www.dewa.gov.ae"},
  {name:"Dubai Silicon Oasis — Business Park", coords:[25.0703,55.3695], type:"wallbox", info:"Business park chargers", source:"https://www.electromaps.com"},
  {name:"ENOC / ADNOC Example — Sheikh Zayed Rd", coords:[25.2040,55.2485], type:"fast", info:"Petrol station DC fast chargers", source:"https://haladrive.ae"},
  {name:"Dubai Marina Walk — Cluster", coords:[25.0755,55.1410], type:"public", info:"Marina Walk chargers", source:"https://www.plugshare.com"},
  {name:"The Address Dubai Marina — Promenade", coords:[25.0789,55.1405], type:"wallbox", info:"Hotel/residence chargers", source:"https://www.plugshare.com"},
  {name:"Umm Suqeim — Beach / Hotels", coords:[25.2390,55.2050], type:"public", info:"Jumeirah beach hotels & chargers", source:"https://haladrive.ae"},
  {name:"Dubai Creek Harbour — Development area", coords:[25.1950,55.3040], type:"public", info:"New development chargers", source:"https://www.electromaps.com"},
  {name:"Al Barsha — Mall / Office", coords:[25.1119,55.1990], type:"wallbox", info:"Al Barsha public/wall chargers", source:"https://www.plugshare.com"},
  {name:"Business Bay — Canal-side", coords:[25.1823,55.2557], type:"public", info:"Business Bay chargers", source:"https://www.plugshare.com"},
  {name:"Zabeel / Za'abeel Park area", coords:[25.2143,55.2631], type:"public", info:"Park / public chargers", source:"https://www.dewa.gov.ae"},
  {name:"Al Quoz — Art District", coords:[25.1955,55.2361], type:"wallbox", info:"Al Quoz commercial chargers", source:"https://www.electromaps.com"},
  {name:"Kite Beach — Jumeirah 2", coords:[25.2413,55.2267], type:"public", info:"Beach parking chargers", source:"https://www.plugshare.com"},
  {name:"Mina Rashid / Port area", coords:[25.2410,55.2880], type:"public", info:"Harbour area chargers", source:"https://www.plugshare.com"},
  {name:"Al Barsha South — Mall cluster", coords:[25.0942,55.1677], type:"public", info:"Retail chargers", source:"https://www.plugshare.com"},
  {name:"Discovery Gardens — Community", coords:[25.0568,55.1972], type:"wallbox", info:"Residence wall-box chargers", source:"https://www.electromaps.com"},
  {name:"The Green Planet / City Walk area", coords:[25.1979,55.2425], type:"public", info:"Leisure area chargers", source:"https://www.plugshare.com"}
];

/* =========================
   Cluster group & markers
   ========================= */
const clusterGroup = L.markerClusterGroup({
  chunkedLoading: true,
  showCoverageOnHover: false,
  spiderfyOnMaxZoom: true
});

const markerRefs = []; // store for list and filter

stations.forEach((s, i) => {
  const marker = L.marker(s.coords, {icon: icons[s.type]});
  const popupContent = `
    <div style="font-weight:700;margin-bottom:6px">${s.name}</div>
    <div style="font-size:13px;color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')};margin-bottom:6px">${s.info}</div>
    <a href="${s.source}" target="_blank" rel="noopener" style="color:var(--accent);font-weight:700;text-decoration:none">Source</a>
  `;
  marker.bindPopup(popupContent, {maxWidth:260});
  marker.station = s; // attach
  markerRefs.push(marker);
  clusterGroup.addLayer(marker);
});
map.addLayer(clusterGroup);

/* =========================
   Populate sidebar list
   ========================= */
const listEl = document.getElementById('stationList');
function renderList(filteredMarkers){
  listEl.innerHTML = '';
  filteredMarkers.forEach((m, idx) => {
    const s = m.station;
    const el = document.createElement('div');
    el.className = 'station';
    el.innerHTML = `
      <h4>${s.name}</h4>
      <p>${s.info}</p>
      <div class="meta">Type: <strong style="color:var(--accent)">${typeLabel(s.type)}</strong></div>
    `;
    el.addEventListener('click', () => {
      map.setView(s.coords, 15, {animate:true});
      m.openPopup();
      if(window.innerWidth <= 980){ sidebar.classList.remove('show'); } // auto-close on mobile
    });
    listEl.appendChild(el);
  });
}
function typeLabel(t){
  if(t==='public') return 'Public (1)';
  if(t==='fast') return 'Fast (2)';
  if(t==='wallbox') return 'Wall-Box (3)';
  return t;
}
// initial render
renderList(markerRefs);

/* =========================
   Filtering controls (chips)
   ========================= */
const chips = document.querySelectorAll('.chip[data-type]');
const activeTypes = new Set(['public','fast','wallbox']);
chips.forEach(chip => {
  chip.addEventListener('click', () => {
    const type = chip.dataset.type;
    if(activeTypes.has(type)){
      activeTypes.delete(type);
      chip.classList.remove('active');
    } else {
      activeTypes.add(type);
      chip.classList.add('active');
    }
    applyFilters();
  });
});

function applyFilters(){
  clusterGroup.clearLayers();
  const visible = [];
  markerRefs.forEach(m => {
    if(activeTypes.has(m.station.type)){
      clusterGroup.addLayer(m);
      visible.push(m);
    }
  });
  renderList(visible);
}

/* =========================
   Search
   ========================= */
document.getElementById('btnSearch').addEventListener('click', doSearch);
document.getElementById('q').addEventListener('keyup', (e)=>{ if(e.key==='Enter') doSearch(); });

function doSearch(){
  const q = document.getElementById('q').value.trim().toLowerCase();
  if(!q){ renderList(markerRefs); map.fitBounds(clusterGroup.getBounds().pad(0.2)); return; }
  const found = markerRefs.filter(m => {
    return m.station.name.toLowerCase().includes(q) || (m.station.info && m.station.info.toLowerCase().includes(q));
  });
  const visible = found.filter(m => activeTypes.has(m.station.type));
  clusterGroup.clearLayers();
  visible.forEach(m => clusterGroup.addLayer(m));
  renderList(visible);
  if(visible.length) map.fitBounds(L.featureGroup(visible).getBounds().pad(0.25));
}

/* =========================
   Locate button
   ========================= */
document.getElementById('btnLocate').addEventListener('click', ()=> {
  if(!navigator.geolocation){ alert('Geolocation not supported'); return; }
  navigator.geolocation.getCurrentPosition(pos => {
    const latlng = [pos.coords.latitude, pos.coords.longitude];
    L.circle(latlng, {radius: Math.max(pos.coords.accuracy,20), color: '#00d07a', fillColor:'#00d07a', fillOpacity:0.1}).addTo(map);
    map.setView(latlng, 14);
    L.marker(latlng).addTo(map).bindPopup('You are here').openPopup();
  }, err => {
    alert('Could not get location or permission denied.');
  }, {enableHighAccuracy:true, timeout:10000});
});

/* =========================
   Mobile sidebar toggle
   ========================= */
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.createElement('button');
toggleBtn.id = 'btnToggleSidebar';
toggleBtn.textContent = '☰';
document.body.appendChild(toggleBtn);
toggleBtn.addEventListener('click', ()=> sidebar.classList.toggle('show'));

/* =========================
   Keyboard accessibility: focus markers via list using arrow keys
   ========================= */
let currentListIndex = -1;
listEl.addEventListener('keydown', (e) => {
  if(e.key === 'ArrowDown') { currentListIndex++; if(currentListIndex >= listEl.children.length) currentListIndex = 0; listEl.children[currentListIndex].focus(); }
  if(e.key === 'ArrowUp') { currentListIndex--; if(currentListIndex < 0) currentListIndex = listEl.children.length -1; listEl.children[currentListIndex].focus(); }
});

/* =========================
   Resize handler
   ========================= */
function handleMobileLayout(){ /* could add future improvements */ }
window.addEventListener('resize', handleMobileLayout);
handleMobileLayout();

</script>
</body>
</html>





